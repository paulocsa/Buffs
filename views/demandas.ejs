<%- include ('partials/header.ejs') %>
<%- include ('partials/nav.ejs') %>
<div class="container">
    <h1>Demandas</h1>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addDemandaModal">
        Adicionar Demanda
    </button>

    <table class="table">
        <thead>
            <tr>
                <th>Data de Início</th>
                <th>Data de Término</th>
                <th>Tipo de Serviço</th>
                <th>Funcionário</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <% demandas.forEach(demanda => { %>
                <tr>
                    <td><%= new Date(demanda.dataInicio).toLocaleDateString() %></td>
                    <td><%= new Date(demanda.dataTermino).toLocaleDateString() %></td>
                    <td><%= demanda.tipoServico %></td>
                    <td><%= demanda.Funcionario.nome %></td>
                    <td>
                        <button type="button" class="btn btn-warning" data-toggle="modal"
                            data-target="#editDemandaModal<%= demanda.id %>">
                            Editar
                        </button>
                        <form action="/deleteDemanda/<%= demanda.id %>" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-danger">Deletar</button>
                        </form>
                    </td>
                </tr>
            <% }); %>
        </tbody>
    </table>
</div>

<!-- Modal Adicionar Demanda -->
<div class="modal fade" id="addDemandaModal" tabindex="-1" role="dialog" aria-labelledby="addDemandaModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form action="/createDemanda" method="POST">
                <div class="modal-header">
                    <h5 class="modal-title" id="addDemandaModalLabel">Cadastrar Demanda</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Formulário de criação de demanda -->
                    <div class="form-group">
                        <label for="dataInicio">Data de Início</label>
                        <input type="date" class="form-control" id="dataInicio" name="dataInicio" required>
                    </div>
                    <div class="form-group">
                        <label for="dataTermino">Data de Término</label>
                        <input type="date" class="form-control" id="dataTermino" name="dataTermino" required>
                    </div>
                    <div class="form-group">
                        <label for="tipoServico">Tipo de Serviço</label>
                        <input type="text" class="form-control" id="tipoServico" name="tipoServico" required>
                    </div>
                    <div class="form-group">
                        <label for="funcionarioId">Funcionário</label>
                        <select class="form-control" id="funcionarioId" name="funcionarioId" required>
                            <option value="">Selecione um funcionário</option>
                            <% funcionarios.forEach(funcionario => { %>
                                <option value="<%= funcionario.id %>"><%= funcionario.nome %></option>
                            <% }); %>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Editar Demanda -->
<% demandas.forEach(demanda => { %>
    <div class="modal fade" id="editDemandaModal<%= demanda.id %>" tabindex="-1" role="dialog" aria-labelledby="editDemandaModalLabel<%= demanda.id %>" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form action="/updateDemanda/<%= demanda.id %>" method="POST">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editDemandaModalLabel<%= demanda.id %>">Editar Demanda</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Formulário de edição de demanda -->
                        <div class="form-group">
                            <label for="dataInicio<%= demanda.id %>">Data de Início</label>
                            <input type="date" class="form-control" id="dataInicio<%= demanda.id %>" name="dataInicio" value="<%= new Date(demanda.dataInicio).toISOString().split('T')[0] %>" required>
                        </div>
                        <div class="form-group">
                            <label for="dataTermino<%= demanda.id %>">Data de Término</label>
                            <input type="date" class="form-control" id="dataTermino<%= demanda.id %>" name="dataTermino" value="<%= new Date(demanda.dataTermino).toISOString().split('T')[0] %>" required>
                        </div>
                        <div class="form-group">
                            <label for="tipoServico<%= demanda.id %>">Tipo de Serviço</label>
                            <input type="text" class="form-control" id="tipoServico<%= demanda.id %>" name="tipoServico" value="<%= demanda.tipoServico %>" required>
                        </div>
                        <div class="form-group">
                            <label for="funcionarioId<%= demanda.id %>">Funcionário</label>
                            <select class="form-control" id="funcionarioId<%= demanda.id %>" name="funcionarioId" required>
                                <option value="">Selecione um funcionário</option>
                                <% funcionarios.forEach(funcionario => { %>
                                    <option value="<%= funcionario.id %>" <%= demanda.funcionarioId === funcionario.id ? 'selected' : '' %>><%= funcionario.nome %></option>
                                <% }); %>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
<% }); %>

<%- include ('partials/footer.ejs') %>
